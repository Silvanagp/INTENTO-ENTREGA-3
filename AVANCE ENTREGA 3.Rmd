---
title: "Análisis del IDH y Calidad Institucional"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(rio)
library(ggplot2)
library(dplyr)
library(corrplot)
library(cluster)
```

Column {data-width=650}
-----------------------------------------------------------------------

### Datos de las integrantes y proyecto
  
```{r}
# Mostrar los datos con formato adecuado
cat("Integrantes:\n")
cat("--> Silvana Gamarra (20222306)\n", 
 "--> Ariana Zuazo (20222630)\n\n")

cat("Curso: Estadística para el Análisis Político 2\n")
cat("Año: 2024")
cat("Proyecto: Cómo la calidad institucional explica el Índice de Desarrollo Humano\n")
```


### DICCIONARIO

```{r}
setwd("~/TRABAJO ESTADISTICA")
data=import("LA REAL REAL DATA .xlsx")
```

```{r}
data <- data %>%
  mutate(across(where(is.numeric), ~ round(., 2)))
```

```{r}
data$calsijud <- as.numeric(data$calsijud)
data$i.gini <- as.numeric(data$i.gini)
```

```{r}
# Leer y mostrar la tabla de diccionario
library(readxl)
diccionario <- read_excel("DICCIONARIO VARIABLES REAL.xlsx", sheet = 1)
```

```{r}
knitr::kable(diccionario, caption = "Diccionario de Variables")

```

Column {data-width=350}
-----------------------------------------------------------------------

### GRAFICO 1

```{r}
ggplot(data, aes(x = region, y = idh.2022, fill = region)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Diagrama de Caja del Índice de Desarrollo Humano (IDH) por Continente", 
       x = "Continente", 
       y = "IDH") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Mejora la legibilidad de los nombres

```

### GRAFICO 2 (CORRELACION)
```{r}
data <- data %>%
  mutate(
    i.gini = as.numeric(i.gini),
    calsijud = as.numeric(calsijud)
  )
```

```{r}
# Selección de variables numéricas para el análisis de correlación
cor_data <- data %>%
  select(calsijud, i.democracia, gob.calidad, i.criminalidad, ipc.2022, PBI.2022, i.gini, i.caphumano)

# Matriz de correlación y mapa de calor
cor_matrix <- cor(cor_data, use = "complete.obs")
corrplot(cor_matrix, method = "color", type = "upper", tl.col = "black", tl.srt = 45)

```
```{r}
# Graficar IDH vs cada variable
library(ggplot2)

variables <- c("calsijud", "i.democracia", "gob.calidad", "i.criminalidad", "ipc.2022", "PBI.2022", "i.gini", "i.caphumano")

for (var in variables) {
  # Generar el gráfico y asegurarse de que se imprima
  p <- ggplot(data, aes_string(x = var, y = "idh.2022")) +
    geom_point(color = "blue") +
    geom_smooth(method = "lm", color = "red") +  # Línea de regresión
    labs(title = paste("Relación entre IDH y", var),
         x = var,
         y = "IDH") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  # Usar print para mostrar el gráfico
  print(p)
}

```

Row {data-width=650}
-----------------------------------------------------------------------

### MODELOS DE REGRESION

```{r}
# Ajuste de regresión
modelo_regresion <- lm(idh.2022 ~ calsijud + i.democracia + gob.calidad + 
                        i.criminalidad + ipc.2022 + PBI.2022 + i.gini + i.caphumano, 
                        data = data)

# Extraer los coeficientes del modelo
summary_model <- summary(modelo_regresion)
coeficientes <- summary_model$coefficients

# Convertir a una tabla bonita con kable
knitr::kable(coeficientes, 
             col.names = c("Estimates", "Std. Error", "t Value", "Pr(>|t|)"),
             caption = "Coeficientes del Modelo de Regresión",
             format = "markdown")
```
Row {data-width=650}
-----------------------------------------------------------------------

### MODELOS DE CLUSTERIZACIÓN

```{r}
# 1. Comprobar si hay NA o NaN en los datos
sum(is.na(cor_data))  # Verifica la cantidad de valores NA

# 2. Eliminar las filas con NA para asegurarse de usar solo las completas para kmeans
cor_data_complete <- na.omit(cor_data)  # Elimina filas con valores NA en cor_data

# 3. Normalizar los datos (solo las filas completas)
cluster_data <- scale(cor_data_complete)  # Normalización de los datos completos

# 4. Aplicar K-means solo a las filas completas
set.seed(123)  # Para reproducibilidad
kmeans_result <- kmeans(cluster_data, centers = 3)  # Ajuste del número de clusters

# 5. Asignar los resultados del clustering a las filas correspondientes en el conjunto original
data$cluster <- NA  # Inicializa la columna 'cluster' en 'data'

# 6. Asignar los resultados del clustering a las filas que tienen datos completos
data[rownames(cor_data_complete), "cluster"] <- kmeans_result$cluster

# 7. Visualizar el resultado de clustering
ggplot(data, aes(x = PBI.2022, y = idh.2022, color = cluster)) +
  geom_point(size = 3) +
  theme_minimal() +
  labs(title = "Clusterización de Países en Base a IDH y PBI", x = "PBI ($)", y = "IDH")

```
```{r}
dataClus=data[,c(3:11)]
row.names(dataClus)=data$paises
```



